<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US"><head>
<meta charset="utf-8">
<meta name="generator" content="ReSpec 35.6.1">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;background:var(--indextable-hover-bg,#fff);color:#000;color:var(--text,#000);box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);box-shadow:0 1em 3em -.4em var(--tocsidebar-shadow,rgba(0,0,0,.3)),0 0 1px 1px var(--tocsidebar-shadow,rgba(0,0,0,.05));border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;border-bottom-color:var(--indextable-hover-bg,#fff);top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1;border-bottom-color:var(--indextable-hover-bg,#a2a9b1)}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;color:var(--text,#000);margin-top:.25em}
.dfn-panel ul a[href]{color:#333;color:var(--text,#333)}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
		
		
<title>Best Practices for Authoring MathML in EPUB</title>
		
<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:italic}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline}
:is(h2,h3,h4,h5,h6):not(#toc>h2,#abstract>h2,#sotd>h2,.head>h2){position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-1.1em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>
		
		
<link href="../css/callout.css" rel="stylesheet" type="text/css">
	
<meta name="color-scheme" content="light">
<style>
.hljs{--base:#fafafa;--mono-1:#383a42;--mono-2:#686b77;--mono-3:#717277;--hue-1:#0b76c5;--hue-2:#336ae3;--hue-3:#a626a4;--hue-4:#42803c;--hue-5:#ca4706;--hue-5-2:#c91243;--hue-6:#986801;--hue-6-2:#9a6a01}
@media (prefers-color-scheme:dark){
.hljs{--base:#282c34;--mono-1:#abb2bf;--mono-2:#818896;--mono-3:#5c6370;--hue-1:#56b6c2;--hue-2:#61aeee;--hue-3:#c678dd;--hue-4:#98c379;--hue-5:#e06c75;--hue-5-2:#be5046;--hue-6:#d19a66;--hue-6-2:#e6c07b}
}
.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;color:var(--mono-1,#383a42);background:#fafafa;background:var(--base,#fafafa)}
.hljs-comment,.hljs-quote{color:#717277;color:var(--mono-3,#717277);font-style:italic}
.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4;color:var(--hue-3,#a626a4)}
.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ca4706;color:var(--hue-5,#ca4706);font-weight:700}
.hljs-literal{color:#0b76c5;color:var(--hue-1,#0b76c5)}
.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#42803c;color:var(--hue-4,#42803c)}
.hljs-built_in,.hljs-class .hljs-title{color:#9a6a01;color:var(--hue-6-2,#9a6a01)}
.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801;color:var(--hue-6,#986801)}
.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#336ae3;color:var(--hue-2,#336ae3)}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:700}
.hljs-link{text-decoration:underline}
</style>
<style>
var:hover{text-decoration:underline;cursor:pointer}
var.respec-hl{color:var(--color,#000);background-color:var(--bg-color);box-shadow:0 0 0 2px var(--bg-color)}
@media (prefers-color-scheme:dark){
var.respec-hl{filter:saturate(.9) brightness(.9)}
}
var.respec-hl-c1{--bg-color:#f4d200}
var.respec-hl-c2{--bg-color:#ff87a2}
var.respec-hl-c3{--bg-color:#96e885}
var.respec-hl-c4{--bg-color:#3eeed2}
var.respec-hl-c5{--bg-color:#eacfb6}
var.respec-hl-c6{--bg-color:#82ddff}
var.respec-hl-c7{--bg-color:#ffbcf2}
@media print{
var.respec-hl{background:0 0;color:#000;box-shadow:unset}
}
</style>
<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#222}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#222;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>
<script id="initialUserConfig" type="application/json">{
  "shortName": "mathML",
  "specStatus": "base",
  "latestVersion": "https://inclusivepublishing.org/mathMLBestPractices",
  "edDraftURI": null,
  "editors": [
    {
      "name": "Avneesh Singh",
      "company": "DAISY Consortium"
    },
    {
      "name": "Charles LaPierre",
      "company": "Benetech"
    },
    {
      "name": "Gregorio Pellegrino",
      "company": "Fondazione LIA"
    }
  ],
  "formerEditors": [
    {
      "name": "George Kerscher",
      "company": "DAISY Consortium"
    }
  ],
  "logos": [
    {
      "src": "https://daisy.github.io/transitiontoepub/daisy_high.jpg",
      "width": 112,
      "height": 100,
      "alt": "DAISY Consortium logo",
      "url": "https://daisy.org"
    }
  ],
  "github": "DAISY/transitiontoepub",
  "publishISODate": "2025-12-10T00:00:00.000Z",
  "generatedSubtitle": "10 December 2025"
}</script>
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/base.css"></head>
    <body class="h-entry informative"><div class="head">
    <p class="logos"><a class="logo" href="https://daisy.org"><img crossorigin="" alt="DAISY Consortium logo" height="100" src="https://daisy.github.io/transitiontoepub/daisy_high.jpg" width="112">
  </a></p>
    <h1 id="title" class="title">Best Practices for Authoring MathML in EPUB</h1> 
    <p id="w3c-state"> <time class="dt-published" datetime="2025-12-10">10 December 2025</time></p>
    <details open="">
      <summary>More details about this document</summary>
      <dl>
        
        <dt>Latest published version:</dt><dd>
                <a href="https://inclusivepublishing.org/mathMLBestPractices">https://inclusivepublishing.org/mathMLBestPractices</a>
              </dd>
        
        <dt>History:</dt><dd>
                    <a href="https://github.com/DAISY/transitiontoepub/commits/">Commit history</a>
                  </dd>
        
        
        
        
        
        <dt>Editors:</dt><dd class="editor p-author h-card vcard">
    <span class="p-name fn">Avneesh Singh</span> (<span class="p-org org h-org">DAISY Consortium</span>)
  </dd><dd class="editor p-author h-card vcard">
    <span class="p-name fn">Charles LaPierre</span> (<span class="p-org org h-org">Benetech</span>)
  </dd><dd class="editor p-author h-card vcard">
    <span class="p-name fn">Gregorio Pellegrino</span> (<span class="p-org org h-org">Fondazione LIA</span>)
  </dd>
        <dt>
                Former editor:
              </dt><dd class="editor p-author h-card vcard">
    <span class="p-name fn">George Kerscher</span> (<span class="p-org org h-org">DAISY Consortium</span>)
  </dd>
        
        <dt>Feedback:</dt><dd>
        <a href="https://github.com/DAISY/transitiontoepub/">GitHub DAISY/transitiontoepub</a>
        (<a href="https://github.com/DAISY/transitiontoepub/pulls/">pull requests</a>,
        <a href="https://github.com/DAISY/transitiontoepub/issues/new/choose">new issue</a>,
        <a href="https://github.com/DAISY/transitiontoepub/issues/">open issues</a>)
      </dd>
        
        
      </dl>
    </details>
    
    
    <p class="copyright">Copyright © DAISY Consortium November 16 2022</p>
    <hr title="Separator for header">
  </div>
    	
    	
    	<section id="abstract" hidden="" class="notoc introductory"><h2>Abstract</h2></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a></li><li class="tocline"><a class="tocxref" href="#recommendations"><bdi class="secno">2. </bdi>Recommendations</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#important-implementation-considerations"><bdi class="secno">2.1 </bdi>Important Implementation Considerations</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#namespace-declaration"><bdi class="secno">2.1.1 </bdi>Namespace Declaration</a></li><li class="tocline"><a class="tocxref" href="#alternative-text-and-image-handling"><bdi class="secno">2.1.2 </bdi>Alternative Text and Image Handling</a></li><li class="tocline"><a class="tocxref" href="#deprecated-attributes"><bdi class="secno">2.1.3 </bdi>Deprecated Attributes</a></li><li class="tocline"><a class="tocxref" href="#aria-attributes"><bdi class="secno">2.1.4 </bdi>ARIA Attributes</a></li></ol></li><li class="tocline"><a class="tocxref" href="#technique-native-mathml"><bdi class="secno">2.2 </bdi>Technique: Native MathML</a></li><li class="tocline"><a class="tocxref" href="#where-mathml-should-not-be-used"><bdi class="secno">2.3 </bdi>Where MathML should not be used</a></li></ol></li><li class="tocline"><a class="tocxref" href="#challenges-in-production-of-accessible-math"><bdi class="secno">3. </bdi>Challenges in production of accessible Math</a></li><li class="tocline"><a class="tocxref" href="#acknowledgements"><bdi class="secno">A. </bdi>Acknowledgments</a></li></ol></nav>

        <section id="introduction"><div class="header-wrapper"><h2 id="x1-introduction"><bdi class="secno">1. </bdi>Introduction</h2><a class="self-link" href="#introduction" aria-label="Permalink for Section 1."></a></div>
        
	    <p>
            Reading scientific and mathematical expressions are essential for students with disabilities for making progress in the field of science, technology, engineering and mathematics. This document recommends best practices for presenting Mathematics in a way which makes it accessible to people with print disabilities.
        </p>

        <p>It is possible that the recommendations for EPUB 3 environments provided in this report are a little different from the recommendations for the web environment. Though most of EPUB 3 reading systems use components from web browsers, the reading systems tend to change and sometimes override the web browser functionality, which results in a somewhat different reading experience.</p>

        </section><section id="recommendations"><div class="header-wrapper"><h2 id="x2-recommendations"><bdi class="secno">2. </bdi>Recommendations</h2><a class="self-link" href="#recommendations" aria-label="Permalink for Section 2."></a></div>

        <p>
            Fortunately, MathML is now widely supported in web browsers and Ebook reading systems. Therefore, MathML should be used for presenting Mathematics.
            There are some instances where the use of MathML is not recommended, these are explained in the section that follows the MathML techniques.
        </p>	    
	    
        <p>Based on test results and future prospects, the following technique is recommended.</p>
        
        <section id="important-implementation-considerations"><div class="header-wrapper"><h3 id="x2-1-important-implementation-considerations"><bdi class="secno">2.1 </bdi>Important Implementation Considerations</h3><a class="self-link" href="#important-implementation-considerations" aria-label="Permalink for Section 2.1"></a></div>
		<p>Based on testing across various reading systems and assistive technologies, the following implementation practices should be carefully observed to ensure optimal accessibility and compatibility.</p>
		
		<section id="namespace-declaration"><div class="header-wrapper"><h4 id="x2-1-1-namespace-declaration"><bdi class="secno">2.1.1 </bdi>Namespace Declaration</h4><a class="self-link" href="#namespace-declaration" aria-label="Permalink for Section 2.1.1"></a></div>
		<p>Do not use global namespaces for MathML (e.g. avoid using the <code>m:</code> prefix namespace within the <code>&lt;html&gt;</code> element). Instead, declare the namespace locally by adding <code>xmlns="http://www.w3.org/1998/Math/MathML"</code> within each <code>&lt;math&gt;</code> element. For implementation examples, refer to the code samples provided in the following sections.</p>
		
		</section><section id="alternative-text-and-image-handling"><div class="header-wrapper"><h4 id="x2-1-2-alternative-text-and-image-handling"><bdi class="secno">2.1.2 </bdi>Alternative Text and Image Handling</h4><a class="self-link" href="#alternative-text-and-image-handling" aria-label="Permalink for Section 2.1.2"></a></div>
		<ul>
			<li><strong>Do not use the <code>alttext</code> attribute:</strong> current implementations do not properly use this attribute for fallback content, resulting in mathematical expressions being read twice by assistive technologies.</li>
			<li><strong>Do not use the <code>altimg</code> attribute:</strong> avoid referencing fallback images through this attribute.</li>
		</ul>
		
		</section><section id="deprecated-attributes"><div class="header-wrapper"><h4 id="x2-1-3-deprecated-attributes"><bdi class="secno">2.1.3 </bdi>Deprecated Attributes</h4><a class="self-link" href="#deprecated-attributes" aria-label="Permalink for Section 2.1.3"></a></div>
		<p>Avoid using deprecated MathML attributes for visual styling. These attributes impact the adaptability of visual formatting to user preferences and may not be supported in future implementations:</p>
		<ul>
			<li><code>mathcolor</code></li>
			<li><code>mathbackground</code></li>
			<li><code>mathsize</code></li>
			<li><code>displaystyle</code></li>
			<li><code>scriptlevel</code></li>
		</ul>
		
		</section><section id="aria-attributes"><div class="header-wrapper"><h4 id="x2-1-4-aria-attributes"><bdi class="secno">2.1.4 </bdi>ARIA Attributes</h4><a class="self-link" href="#aria-attributes" aria-label="Permalink for Section 2.1.4"></a></div>
		<p>Do not apply ARIA attributes to MathML elements. Native MathML provides its own accessibility semantics, and adding ARIA attributes (such as <code>role="math"</code>, <code>aria-label</code>, or <code>aria-describedby</code>) can create conflicts or redundancy in how assistive technologies interpret the mathematical content.</p>
        
        </section></section><section id="technique-native-mathml"><div class="header-wrapper"><h3 id="x2-2-technique-native-mathml"><bdi class="secno">2.2 </bdi>Technique: Native MathML</h3><a class="self-link" href="#technique-native-mathml" aria-label="Permalink for Section 2.2"></a></div>
        <div class="simplecalloutbox_preheader">    
            <div class="header-wrapper"><h3 id="code-example-1-block-mathml">Code Example #1: Block MathML</h3><a class="self-link" href="#code-example-1-block-mathml" aria-label="Permalink for this Section"></a></div>
            </div>
            <div class="simplecalloutbox">
                <pre>        <code aria-busy="false" class="hljs xml">
<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Some Text before the math equation<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">math</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/1998/Math/MathML"</span> <span class="hljs-attr">display</span>=<span class="hljs-string">"block"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mrow</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>y<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>−<span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">msub</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>y<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mn</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">mn</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">msub</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mrow</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>=<span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mrow</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mfrac</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mrow</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">msub</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>y<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">mn</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">mn</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">msub</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>−<span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">msub</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>y<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">mn</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">mn</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">msub</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">mrow</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mrow</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">msub</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>x<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">mn</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">mn</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">msub</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>−<span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">msub</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>x<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">mn</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">mn</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">msub</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">mrow</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">mfrac</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>
            ⁢<span class="hljs-comment">&lt;!--invisible times--&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mrow</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>(<span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mrow</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>x<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>−<span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">msub</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>x<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">mn</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">mn</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">msub</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">mrow</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>)<span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">mrow</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mrow</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">math</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Some text after the equation.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        </code></pre>

            <div class="simplecalloutbox_preheader">    
            <div class="header-wrapper"><h3 id="code-example-1-preview-block-mathml">Code Example #1 Preview: Block MathML</h3><a class="self-link" href="#code-example-1-preview-block-mathml" aria-label="Permalink for this Section"></a></div>
            </div>
            <div class="simplecalloutbox">
            <p>
            Some Text before the math equation
            </p>
            <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
               <mrow>
                    <mi>y</mi>
                    <mo>−</mo>
                    <msub>
                        <mi>y</mi>
                        <mn>1</mn>
                    </msub>
                </mrow>
                <mo>=</mo>
                <mrow>
                    <mfrac>
                        <mrow>
                            <msub>
                                <mi>y</mi>
                                <mn>2</mn>
                            </msub>
                            <mo>−</mo>
                            <msub>
                                <mi>y</mi>
                                <mn>1</mn>
                            </msub>
                        </mrow>
                        <mrow>
                            <msub>
                                <mi>x</mi>
                                <mn>2</mn>
                            </msub>
                            <mo>−</mo>
                            <msub>
                                <mi>x</mi>
                                <mn>1</mn>
                            </msub>
                        </mrow>
                    </mfrac>
                    <mo>⁢</mo>
                    <mrow>
                        <mo>(</mo>
                        <mrow>
                            <mi>x</mi>
                            <mo>−</mo>
                            <msub>
                                <mi>x</mi>
                                <mn>1</mn>
                            </msub>
                        </mrow>
                        <mo>)</mo>
                    </mrow>
                </mrow>
            </math>
        <p>
            Some text after the equation.
        </p>
                </div>
        </div>
        <div class="simplecalloutbox_preheader">   
        <div class="header-wrapper"><h3 id="code-example-2-inline-mathml">Code Example #2: Inline MathML</h3><a class="self-link" href="#code-example-2-inline-mathml" aria-label="Permalink for this Section"></a></div>
        </div>
        <div class="simplecalloutbox">
        <pre><code aria-busy="false" class="hljs xml">
<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
    Some Text before the math equation
    <span class="hljs-tag">&lt;<span class="hljs-name">math</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/1998/Math/MathML"</span> <span class="hljs-attr">display</span>=<span class="hljs-string">"inline"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mrow</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>y<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>−<span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">msub</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>y<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">mn</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">mn</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">msub</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">mrow</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>=<span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mrow</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mfrac</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">mrow</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">msub</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>y<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">mn</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">mn</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">msub</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>−<span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">msub</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>y<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">mn</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">mn</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">msub</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">mrow</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">mrow</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">msub</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>x<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">mn</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">mn</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">msub</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>−<span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">msub</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>x<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">mn</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">mn</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">msub</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">mrow</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">mfrac</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>
                ⁢<span class="hljs-comment">&lt;!--invisible times--&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mrow</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>(<span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">mrow</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>x<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>−<span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">msub</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">mi</span>&gt;</span>x<span class="hljs-tag">&lt;/<span class="hljs-name">mi</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">mn</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">mn</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">msub</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">mrow</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">mo</span>&gt;</span>)<span class="hljs-tag">&lt;/<span class="hljs-name">mo</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">mrow</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">mrow</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">math</span>&gt;</span>
    Some text after the equation.
<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>  
        </code></pre>
    <div class="simplecalloutbox_preheader">    
        <div class="header-wrapper"><h3 id="code-example-2-preview-inline-mathml">Code Example #2 Preview: Inline MathML</h3><a class="self-link" href="#code-example-2-preview-inline-mathml" aria-label="Permalink for this Section"></a></div>
    </div>
    <div class="simplecalloutbox">
        <p>
	Some Text before the math equation
            <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline">
               <mrow>
                    <mi>y</mi>
                    <mo>−</mo>
                    <msub>
                        <mi>y</mi>
                        <mn>1</mn>
                    </msub>
                </mrow>
                <mo>=</mo>
                <mrow>
                    <mfrac>
                        <mrow>
                            <msub>
                                <mi>y</mi>
                                <mn>2</mn>
                            </msub>
                            <mo>−</mo>
                            <msub>
                                <mi>y</mi>
                                <mn>1</mn>
                            </msub>
                        </mrow>
                        <mrow>
                            <msub>
                                <mi>x</mi>
                                <mn>2</mn>
                            </msub>
                            <mo>−</mo>
                            <msub>
                                <mi>x</mi>
                                <mn>1</mn>
                            </msub>
                        </mrow>
                    </mfrac>
                    <mo>⁢</mo>
                    <mrow>
                        <mo>(</mo>
                        <mrow>
                            <mi>x</mi>
                            <mo>−</mo>
                            <msub>
                                <mi>x</mi>
                                <mn>1</mn>
                            </msub>
                        </mrow>
                        <mo>)</mo>
                    </mrow>
                </mrow>
            </math>
            Some text after the equation.
        </p>
        </div>
        </div>
	    
        </section><section id="where-mathml-should-not-be-used"><div class="header-wrapper"><h3 id="x2-3-where-mathml-should-not-be-used"><bdi class="secno">2.3 </bdi>Where MathML should not be used</h3><a class="self-link" href="#where-mathml-should-not-be-used" aria-label="Permalink for Section 2.3"></a></div>

        <p>MathML should not be used at the places where numbers and symbols are the part of the text, for example.</p>
        <ul>
            <li>Adam is 65 years old.</li>
            <li>The zip code of the office is NY 10036.</li>
<li>My mobile number is 78950 55823.</li>
            </ul>
        <p>In these examples, the numbers are actually the words in the text of the publication. Therefore MathML should not be used in such places.</p>
        
        </section></section><section id="challenges-in-production-of-accessible-math"><div class="header-wrapper"><h2 id="x3-challenges-in-production-of-accessible-math"><bdi class="secno">3. </bdi>Challenges in production of accessible Math</h2><a class="self-link" href="#challenges-in-production-of-accessible-math" aria-label="Permalink for Section 3."></a></div>
        <p>While MathML is the recommended approach for accessible mathematical content in EPUB publications, the practical implementation of comprehensive MathML markup involves various considerations and challenges in real-world publishing workflows.</p>
        <p>These range from technical and workflow integration issues to questions about when and how to apply MathML most effectively across different types of mathematical content. The publishing industry continues to evolve its approaches to balancing accessibility requirements with production efficiency and visual presentation needs.</p>
        <p>For a detailed examination of current implementation challenges and ongoing discussions in this area, see <a href="mathML-challenges.html">Challenges in production of accessible Math</a>.</p>
	    
      	</section><section class="appendix informative" id="acknowledgements"><div class="header-wrapper"><h2 id="a-acknowledgments"><bdi class="secno">A. </bdi>Acknowledgments</h2><a class="self-link" href="#acknowledgements" aria-label="Permalink for Appendix A."></a></div><p><em>This section is non-normative.</em></p>
			
			
			<p>The following people contributed to the development of this document:</p>
			
			<ul>
				<li>Avneesh Singh, DAISY Consortium</li>
				<li>Charles LaPierre, Benetech</li>
				<li>Chris Stynes, HMH</li>
				<li>Gautier Chomel, EDRLab</li>
				<li>George Kerscher, DAISY Consortium</li>
				<li>Gregorio Pellegrino, Fondazione LIA</li>
				<li>Ibrahim Siddo, Oxford University Press</li>
				<li>James Yanchak, Taylor &amp; Francis</li>
				<li>Cody Care, EBSCO</li>
				<li>Mark Dunn, Oxford University Press</li>
				<li>Marthe Gjelstad, National Library of Norway (NB)</li>
				<li>Richard Orme, DAISY Consortium</li>
				<li>Sagiv Lapkin, Taylor &amp; Francis</li>
				<li>Steve Noble, Pearson</li>
				<li>Tim Arborealis Lötberg, Swedish Agency for Accessible Media (MTM)</li>
			</ul>
		</section>
    

<p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><script id="respec-highlight-vars">(() => {
// @ts-check

if (document.respec) {
  document.respec.ready.then(setupVarHighlighter);
} else {
  setupVarHighlighter();
}

function setupVarHighlighter() {
  document
    .querySelectorAll("var")
    .forEach(varElem => varElem.addEventListener("click", highlightListener));
}

function highlightListener(ev) {
  ev.stopPropagation();
  const { target: varElem } = ev;
  const hightligtedElems = highlightVars(varElem);
  const resetListener = () => {
    const hlColor = getHighlightColor(varElem);
    hightligtedElems.forEach(el => removeHighlight(el, hlColor));
    [...HL_COLORS.keys()].forEach(key => HL_COLORS.set(key, true));
  };
  if (hightligtedElems.length) {
    document.body.addEventListener("click", resetListener, { once: true });
  }
}

// availability of highlight colors. colors from var.css
const HL_COLORS = new Map([
  ["respec-hl-c1", true],
  ["respec-hl-c2", true],
  ["respec-hl-c3", true],
  ["respec-hl-c4", true],
  ["respec-hl-c5", true],
  ["respec-hl-c6", true],
  ["respec-hl-c7", true],
]);

function getHighlightColor(target) {
  // return current colors if applicable
  const { value } = target.classList;
  const re = /respec-hl-\w+/;
  const activeClass = re.test(value) && value.match(re);
  if (activeClass) return activeClass[0];

  // first color preference
  if (HL_COLORS.get("respec-hl-c1") === true) return "respec-hl-c1";

  // otherwise get some other available color
  return [...HL_COLORS.keys()].find(c => HL_COLORS.get(c)) || "respec-hl-c1";
}

function highlightVars(varElem) {
  const textContent = norm(varElem.textContent);
  const parent = varElem.closest(".algorithm, section");
  const highlightColor = getHighlightColor(varElem);

  const varsToHighlight = [...parent.querySelectorAll("var")].filter(
    el =>
      norm(el.textContent) === textContent &&
      el.closest(".algorithm, section") === parent
  );

  // update availability of highlight color
  const colorStatus = varsToHighlight[0].classList.contains("respec-hl");
  HL_COLORS.set(highlightColor, colorStatus);

  // highlight vars
  if (colorStatus) {
    varsToHighlight.forEach(el => removeHighlight(el, highlightColor));
    return [];
  } else {
    varsToHighlight.forEach(el => addHighlight(el, highlightColor));
  }
  return varsToHighlight;
}

function removeHighlight(el, highlightColor) {
  el.classList.remove("respec-hl", highlightColor);
  // clean up empty class attributes so they don't come in export
  if (!el.classList.length) el.removeAttribute("class");
}

function addHighlight(elem, highlightColor) {
  elem.classList.add("respec-hl", highlightColor);
}

/**
 * Same as `norm` from src/core/utils, but our build process doesn't allow
 * imports in runtime scripts, so duplicated here.
 * @param {string} str
 */
function norm(str) {
  return str.trim().replace(/\s+/g, " ");
}
})()</script><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>